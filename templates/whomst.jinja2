<style>
  #whomst {
  margin-left: auto;
  margin-right: auto;
  text-align: left;
  }

  table, th, td {
  border: 1px solid black;
  }
</style>

<table id="whomst">
  <tr>
    <td>Display name</td>
    <td>Connect code</td>
    <td>IP-address</td>
    <td>Area</td>
    <td>Timestamp</td>
    <td>Note</td>
  </tr>
  {% for whomst in whomsts %}
    <tr>
      <td id="#display_name{{ loop.index }}">
	{{ whomst['display_name'] }}
      </td>
      <td id="#connect_code{{ loop.index }}">
	<a href="/whomst/search/connect_code/{{ whomst['connect_code'] | replace("#", "_") }}">
	  {{ whomst['connect_code'] }}
	</a>
      </td>
      <td id="#ip_address{{ loop.index }}">
	<a href="/whomst/search/ip_address/{{ whomst['ip_address'] }}/24">
	  {{ whomst['ip_address'] }}
	</a>
      </td>
      <td>
	{{ whomst['region'] }}
      </td>
      <td>
	{{ whomst['time_added'] }}
      </td>
      <td class=".note" id="#note{{ loop.index }}">
	{{ whomst['note'] if whomst['note'] }}
      </td>
    </tr>
  {% endfor %}
</table>

<script>
  let elements = document.getElementsByClassName(".note");
  for (let i = 0; i < elements.length; ++i) {
    elements[i].addEventListener("click", note);
  }

  function note() {
    let id = this.id.substring("#note".length);
    let note_content = prompt("whomst note be:");

    let display_name = document.getElementById("#display_name" + id).innerText;
    let connect_code = document.getElementById("#connect_code" + id).innerText;
    let ip_address = document.getElementById("#ip_address" + id).innerText;

    let xhr = new XMLHttpRequest();
    let url = "/whomst/note";
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-Type", "application/json");
    let data = JSON.stringify({
      "note": note_content,
      "display_name": display_name,
      "connect_code": connect_code,
      "ip_address": ip_address,
    });
    xhr.send(data);

    this.innerText = note_content;
  }
</script>
